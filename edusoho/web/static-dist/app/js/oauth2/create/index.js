webpackJsonp(["app/js/oauth2/create/index"],{0:function(e,t){e.exports=jQuery},"04e12e97a64b943320e3":function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a("7ab4a89ebadbfdecc2bf"),n=s(r),i=a("4602c3f5fe7ad9e3e91d"),d=s(i),o=a("e104a65d9efb9ac573bc"),c=a("b334fd7e4c5a19234db2"),u=(s(c),a("0fcd3a355c9fe74234e3")),l=a("5eb223de522186da1dd9"),h=s(l),f=a("bbc0ef257199acca9fed"),m=s(f),p=function(){function e(){(0,n.default)(this,e),this.$form=$("#third-party-create-account-form"),this.$btn=$(".js-submit-btn"),this.validator=null,this.dragCaptchaToken="",this.smsToken=null,this.$sendBtn=$(".js-sms-send"),this.drag=!!$("#drag-btn").length&&new m.default($("#drag-btn"),$(".js-jigsaw"),{limitType:"bind_register"}),this.init()}return(0,d.default)(e,[{key:"init",value:function(){this.setValidateRule(),this.initValidator(),this.smsSend(),this.submitForm(),this.removeSmsErrorTip(),this.dragEvent()}},{key:"setValidateRule",value:function(){$.validator.addMethod("spaceNoSupport",function(e,t){return e.indexOf(" ")<0},$.validator.format(Translator.trans("validate.have_spaces")))}},{key:"dragEvent",value:function(){var e=this;this.drag&&this.drag.on("success",function(t){e.$sendBtn.attr("disabled",!1),e.dragCaptchaToken=t.token}),$(".js-drag-jigsaw").hasClass("hidden")||this.addDragCaptchaRules()}},{key:"initValidator",value:function(){this.rules={username:{required:!0,byte_minlength:4,byte_maxlength:18,nickname:!0,chinese_alphanumeric:!0,es_remote:{type:"get"}},invitedCode:{required:!1,reg_inviteCode:!0,es_remote:{type:"get"}},password:{required:!0,minlength:5,maxlength:20,spaceNoSupport:!0},confirmPassword:{required:!0,equalTo:"#password"},sms_code:{required:!0,unsigned_integer:!0,rangelength:[6,6]},agree_policy:{required:!0}},this.validator=this.$form.validate({rules:this.rules,messages:{sms_code:{required:Translator.trans("site.captcha_code.required"),rangelength:Translator.trans("validate.sms_code.message")},agree_policy:{required:Translator.trans("validate.valid_policy_input.message")}}})}},{key:"smsSend",value:function(){var e=this,t=this,a=$("#captcha_code");this.$sendBtn.length&&this.$sendBtn.click(function(s){t.smsSended||($.ajaxSetup({global:!1}),t.smsSended=!0),t.$sendBtn.attr("disabled",!0);var r={type:"register",mobile:$(".js-account").text(),dragCaptchaToken:e.dragCaptchaToken,phrase:a.val()};h.default.sms.send({data:r}).then(function(t){$.ajaxSetup({global:!0}),e.smsToken=t.smsToken,(0,u.countDown)(120)}).catch(function(e){t.drag&&($.ajaxSetup({global:!0}),t.addDragCaptchaRules(),t.drag.initDragCaptcha(),$(".js-drag-jigsaw").removeClass("hidden"))})})}},{key:"submitForm",value:function(){var e=this;this.$btn.click(function(t){var a=$(t.target);if(e.validator.form()){a.button("loading");var s={nickname:$("#username").val(),password:$("#password").val(),mobile:$(".js-account").html(),smsToken:e.smsToken,smsCode:$("#sms-code").val(),captchaToken:e.captchaToken,phrase:$("#captcha_code").val(),dragCaptchaToken:$('[name="dragCaptchaToken"]').val(),invitedCode:$("#invitedCode").length>0?$("#invitedCode").val():""},r=Translator.trans("oauth.send.sms_code_error_tip");$.post(a.data("url"),s,function(e){a.button("reset"),1===e.success?window.location.href=e.url:$(".js-password-error").length||a.prev().addClass("has-error").append('<p id="password-error" class="form-error-message js-password-error">'+r+"</p>")}).error(function(e){a.button("reset")})}}),(0,o.enterSubmit)(this.$form,this.$btn)}},{key:"addDragCaptchaRules",value:function(){$('[name="dragCaptchaToken"]').rules("add",{required:!0,messages:{required:Translator.trans("auth.register.drag_captcha_tips")}})}},{key:"removeSmsErrorTip",value:function(){$("#sms-code").focus(function(){var e=$(".js-password-error");e.length&&e.remove()})}}]),e}();t.default=p},"0fcd3a355c9fe74234e3":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countDown=void 0;var s=a("b334fd7e4c5a19234db2"),r=function(e){return e&&e.__esModule?e:{default:e}}(s),n=$(".js-time-left"),i=$(".js-sms-send"),d=$(".js-fetch-btn-text"),o=(t.countDown=function(e){n.html(e),d.html(Translator.trans("site.data.get_sms_code_again_btn")),(0,r.default)("success",Translator.trans("site.data.get_sms_code_success_hint")),o()},function e(){var t=n.text();n.html(t-1),t-1>0?(i.attr("disabled",!0),setTimeout(e,1e3)):(n.html(""),d.html(Translator.trans("oauth.send.validate_message")),i.removeAttr("disabled"))})},"1d43a4025aadc22df310":function(e,t,a){"use strict";var s=a("04e12e97a64b943320e3");new(function(e){return e&&e.__esModule?e:{default:e}}(s).default)},e104a65d9efb9ac573bc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){e.keypress(function(e){13==e.which&&(t.trigger("click"),e.preventDefault())})};t.enterSubmit=s}},["1d43a4025aadc22df310"]);