webpackJsonp(["app/js/activity-manage/download/index"],{0:function(a,e){a.exports=jQuery},acb7a9eb3f93d9000adf:function(a,e,t){"use strict";var i=t("fbf0b6283b62b602eb6b");new(function(a){return a&&a.__esModule?a:{default:a}}(i).default)},fbf0b6283b62b602eb6b:function(a,e,t){"use strict";function i(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(e,"__esModule",{value:!0});var l=t("6415c664294d747ee392"),s=i(l),n=t("14f78623669da6cd31fb"),r=i(n),d=t("7ab4a89ebadbfdecc2bf"),o=i(d),m=t("4602c3f5fe7ad9e3e91d"),u=i(m),c=t("eca7a2561fa47d3f75f6"),f=i(c),h=t("b334fd7e4c5a19234db2"),v=(i(h),t("9181c6995ae8c5c94b7a")),p=t("f324dbdea53170d5000f"),y=function(){function a(){(0,o.default)(this,a),this.$form=$("#step2-form"),this.firstName=$("#title").val(),this.media=(0,r.default)(null),this.materials=(0,r.default)(null),this.initStep2Form(),this.bindEvent(),this.initFileChooser()}return(0,u.default)(a,[{key:"initStep2Form",value:function(){this.$form.validate({rules:{title:{required:!0,maxlength:50,trim:!0,course_title:!0},link:"url",materials:"required"},messages:{link:Translator.trans("activity.download_manage.link_error_hint"),materials:Translator.trans("activity.download_manage.materials_error_hint")}})}},{key:"bindEvent",value:function(){var a=this;this.$form.on("click",".js-btn-delete",function(e){return a.deleteItem(e)}),this.$form.on("click",".js-video-import",function(){return a.importLink()}),this.$form.on("click",".js-add-file-list",function(){return a.addFile()}),this.$form.on("blur","#title",function(e){return a.changeTitle(e)})}},{key:"deleteItem",value:function(a){var e=$(a.currentTarget).closest("li"),t=e.data("id"),i=$("#materials");this.materials=(0,v.isEmpty)(i.val())?(0,r.default)(null):JSON.parse(i.val()),this.materials&&this.materials[t]&&(delete this.materials[t],i.val((0,s.default)(this.materials))),e.siblings("li").length||i.val(""),e.remove()}},{key:"initFileChooser",value:function(){var a=this,e=function(e){$("#media").val((0,s.default)(e)),(0,p.chooserUiOpen)(),$("#title").val(a.firstName),$(".js-current-file").text(e.name)};(new f.default).on("select",e)}},{key:"changeTitle",value:function(a){var e=$(a.currentTarget);this.firstName=e.val()}},{key:"importLink",value:function(){var a=$("#link"),e=$("#verifyLink");this.$form.data("validator").valid()&&a.val()?e.val(a.val()):(a.val(""),e.val("")),$(".js-current-file").text(e.val())}},{key:"addLink",value:function(){var a=$("#verifyLink").val(),e={source:"link",id:a,name:a,link:a,summary:$("#file-summary").val(),size:0};$("#media").val((0,s.default)(e))}},{key:"addFile",value:function(){var a=$("#media"),e=$("#materials"),t=$(".js-success-redmine"),i=$(".js-danger-redmine");return $("#verifyLink").val()&&this.addLink(),this.media=(0,v.isEmpty)(a.val())?(0,r.default)(null):JSON.parse(a.val()),this.materials=(0,v.isEmpty)(e.val())?(0,r.default)(null):JSON.parse(e.val()),(0,v.isEmpty)(this.media)?void this.showTip(t,i,"activity.download_manage.materials_error_hint"):!(0,v.isEmpty)(this.materials)&&this.checkExisted()?void this.showTip(t,i,"activity.download_manage.materials_exist_error_hint"):(this.media.summary=$("#file-summary").val(),this.materials[this.media.id]=this.media,e.val((0,s.default)(this.materials)),this.firstName||(this.firstName=this.media.name,$("#title").val(this.firstName)),this.showFile(),this.showTip(i,t,"activity.download_manage.materials_add_success_hint"),void($(".jq-validate-error:visible").length&&this.$form.data("validator").form()))}},{key:"checkExisted",value:function(){for(var a in this.materials){var e=this.materials[a],t=e.name===this.media.name,i=e.link&&e.link===this.media.id;if(t||i)return!0}return!1}},{key:"showFile",value:function(){var a="";a=this.media.link?'\n        <li class="download-item" data-id="'+this.media.link+'">\n          <a class="gray-primary" href="'+this.media.link+'" target="_blank">'+(this.media.summary?this.media.summary:this.media.name)+'<span class="glyphicon glyphicon-new-window text-muted text-sm mlm" title="'+Translator.trans("activity.download_manage.materials_delete_btn")+'"></span></a>\n          <a class="gray-primary phm btn-delete js-btn-delete" href="javascript:;" data-url="" data-toggle="tooltip" data-placement="top" title="'+Translator.trans("activity.download_manage.materials_delete_btn")+'"><i class="es-icon es-icon-delete"></i></a>\n        </li>\n      ':'\n        <li class="download-item" data-id="'+this.media.id+'">\n          <a class="gray-primary" href="/materiallib/'+this.media.id+'/download">'+this.media.name+'</a>\n          <a class="gray-primary phm btn-delete js-btn-delete" href="javascript:;" data-url="" data-toggle="tooltip" data-placement="top" title="'+Translator.trans("activity.download_manage.materials_delete_btn")+'"><i class="es-icon es-icon-delete"></i></a>\n        </li>\n      ',$("#material-list").append(a),$('[data-toggle="tooltip"]').tooltip()}},{key:"showTip",value:function(a,e,t){a.hide(),$(".js-current-file").text(""),$("#link").val(""),$("#verifyLink").val(""),$("#file-summary").val(""),$("#media").val(""),e.text(Translator.trans(t)).show(),setTimeout(function(){e.slideUp()},3e3)}}]),a}();e.default=y}},["acb7a9eb3f93d9000adf"]);