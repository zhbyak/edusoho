webpackJsonp(["app/js/auth/login-ajax/index"],{"15922bb71c26e0956957":function(e,s,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(s,"__esModule",{value:!0});var t=n("7ab4a89ebadbfdecc2bf"),o=i(t),a=n("4602c3f5fe7ad9e3e91d"),d=i(a),l=function(){function e(s){(0,o.default)(this,e),this.options=s,this.$element=this.options.element,this.$loginDom=$(".js-sts-login"),this.init()}return(0,d.default)(e,[{key:"init",value:function(){this.bindEvent(),this.closeModal()}},{key:"bindEvent",value:function(){var e=this;this.$loginDom.on("click",".js-login-back",function(){return e.back()}),this.$loginDom.on("click",".js-invalid-btn",function(){return e.refresh()}),this.$loginDom.on("click",".js-approve-again-btn",function(){return e.approveAgain()}),this.$element.on("click",".js-sts-login-link",function(){return e.showQrcode()})}},{key:"back",value:function(){$(".js-approve-ing, .js-feedback, .js-sts-login").addClass("hidden"),this.options.target?this.$element.find(this.options.target).removeClass("hidden"):this.$element.removeClass("hidden")}},{key:"showQrcode",value:function(){var e=this;$.ajax({type:"post",url:this.$loginDom.data("url"),dataType:"json",success:function(s){e.$loginDom.find(".js-sts-login-qrcode img").attr("src",s.qrcode),e.onlyShow(),e.token=s.token,e.pollStatus()}})}},{key:"approveAgain",value:function(){$(".js-feedback").addClass("hidden"),$(".js-login-section, .js-sts-tip").removeClass("hidden"),this.refresh()}},{key:"refresh",value:function(){$(".js-approve-ing").addClass("hidden"),this.showQrcode()}},{key:"pollStatus",value:function(){var e=this,s=this.token,n=this.$loginDom.data("goto"),i=$(".js-fail-feedback"),t=$(".js-success-feedback"),o=$(".js-fail-tip"),a=$(".js-approve-again-btn");this.$loginDom.hasClass("hidden")||this.flag||$.get("/login/face_token/"+s,{goto:n},function(s){switch(s.status){case"created":setTimeout(function(){e.pollStatus()},2e3);break;case"processing":$(".js-invalid-btn").addClass("hidden"),$(".js-approve-ing, .js-approve-ing-tip").removeClass("hidden"),setTimeout(function(){e.pollStatus()},2e3);break;case"expired":$(".js-approve-ing-tip").addClass("hidden"),$(".js-approve-ing, .js-invalid-btn").removeClass("hidden");break;case"successed":e.statusShow(),t.removeClass("hidden").siblings().addClass("hidden"),window.location.href=s.url;break;case"failed":e.feedbackShow(i,a,o);break;case"failures":e.feedbackShow(i,o,a)}})}},{key:"closeModal",value:function(){var e=this;$("#login-modal").on("hide.bs.modal",function(){e.flag=!0})}},{key:"onlyShow",value:function(){$(".js-sts-login, .js-login-section, .js-sts-tip").removeClass("hidden"),this.options.target?this.$element.find(this.options.target).addClass("hidden"):this.$element.addClass("hidden")}},{key:"statusShow",value:function(){$(".js-login-section, .js-sts-tip").addClass("hidden"),$(".js-feedback").removeClass("hidden")}},{key:"feedbackShow",value:function(e,s,n){this.statusShow(),e.removeClass("hidden").siblings().addClass("hidden"),s.removeClass("hidden"),n.addClass("hidden")}}]),e}();s.default=l},"230971c9cdccda257425":function(e,s,n){"use strict";var i=n("15922bb71c26e0956957"),t=function(e){return e&&e.__esModule?e:{default:e}}(i),o=$("#login-ajax-form"),a=$(".js-submit-login-ajax"),d=o.validate({rules:{_username:{required:!0},_password:{required:!0}}});a.click(function(e){d.form()&&$.post(o.attr("action"),o.serialize(),function(e){a.button("loading"),window.location.reload()},"json").error(function(e,s,n){var i=jQuery.parseJSON(e.responseText);o.find(".alert-danger").html(Translator.trans(i.message)).show()})}),$(".js-sts-login-link").length&&new t.default({element:$(".js-login-modal"),target:".js-login-form, .modal-footer"})}},["230971c9cdccda257425"]);