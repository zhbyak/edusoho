webpackJsonp(["app/js/open-course-manage/lesson-modal/index"],{0:function(e,t){e.exports=jQuery},"573bea85e00feb665261":function(e,t,a){"use strict";var i=a("f7f8f67a4d1dcb4de779");new(function(e){return e&&e.__esModule?e:{default:e}}(i).default)({element:"#modal",form:"#lesson-create-form"})},b00a2728f54f5fed6ab0:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a("7ab4a89ebadbfdecc2bf"),s=i(n),r=a("4602c3f5fe7ad9e3e91d"),l=i(r),o=a("b334fd7e4c5a19234db2"),d=i(o),u=function(){function e(t){(0,s.default)(this,e),this.element=$(t),this.upload_id="subtitle-uploader",this.inited=!1,this.element.length>0&&(this.init(),this.inited=!0);var a=this.element.closest("#video-subtitle-form-group");a.find("#ext_mediaId_for_subtitle").val()>0&&this.render({id:a.find("#ext_mediaId_for_subtitle").val()})}return(0,l.default)(e,[{key:"init",value:function(){var e=this;this.element.on("click",".js-subtitle-delete",function(){var t=$(this);$.post(t.data("subtitleDeleteUrl"),function(a){a&&((0,d.default)("success",Translator.trans("activity.video_manage.delete_success_hint")),t.parent().remove(),$("#"+e.upload_id).show())})})}},{key:"render",value:function(e){if(this.inited&&e&&"id"in e&&e.id>0){this.media=e,this.element.html(Translator.trans("activity.video_manage.subtitle_load_hint"));var t=this;$.get(this.element.data("dialogUrl"),{mediaId:this.media.id},function(e){t.element.html(e),t.initUploader()})}}},{key:"initUploader",value:function(){var e=this,t=$("#"+this.upload_id),a=$(".js-subtitle-dialog").data("mediaId"),i=t.data("mediaGlobalId");this.uploader&&this._destroyUploader();var n=new UploaderSDK({sdkBaseUri:app.cloudSdkBaseUri,disableDataUpload:app.cloudDisableLogReport,disableSentry:app.cloudDisableLogReport,initUrl:t.data("initUrl"),finishUrl:t.data("finishUrl"),id:this.upload_id,ui:"simple",multi:!0,accept:{extensions:["srt"],mimeTypes:["text/srt"]},type:"sub",process:{common:{videoNo:i}},locale:document.documentElement.lang});n.on("error",function(e){"Q_TYPE_DENIED"===e.error&&(0,d.default)("danger",Translator.trans("activity.video_manage.subtitle_upload_error_hint"))}),n.on("file.finish",function(i){$.post(t.data("subtitleCreateUrl"),{name:i.name,subtitleId:i.id,mediaId:a}).success(function(t){var i={waiting:Translator.trans("activity.video_manage.convert_status_waiting"),doing:Translator.trans("activity.video_manage.convert_status_doing"),success:Translator.trans("activity.video_manage.convert_status_success"),error:Translator.trans("activity.video_manage.convert_status_error"),none:Translator.trans("activity.video_manage.convert_status_none")};$(".js-media-subtitle-list").append('<li class="pvs mtm"><span class="subtitle-name prl pull-left">'+t.name+'</span><span class="subtitle-transcode-status '+t.convertStatus+'">'+i[t.convertStatus]+'</span><a href="javascript:;" class="btn-link pll color-primary js-subtitle-delete" data-subtitle-delete-url="/media/'+a+"/subtitle/"+t.id+'/delete">'+Translator.trans("activity.video_manage.subtitle_delete_hint")+"</a></li>"),$(".js-media-subtitle-list li").length>3&&$("#"+e.upload_id).hide(),(0,d.default)("success",Translator.trans("activity.video_manage.subtitle_upload_success_hint"))}).error(function(e){(0,d.default)("danger",e.responseJSON.error.message)})}),this.uploader=n}},{key:"show",value:function(){var e=this.element.parent(".form-group");e.length>0&&e.removeClass("hide")}},{key:"hide",value:function(){var e=this.element.parent(".form-group");e.length>0&&e.addClass("hide")}},{key:"_destroyUploader",value:function(){if(this.uploader){this.uploader.__events=null;try{this.uploader.destroy()}catch(e){}this.uploader=null}}},{key:"destroy",value:function(){this.inited&&this._destroyUploader()}}]),e}();t.default=u},b4fbf03f4f16003fe503:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=arguments,n=function(e,t){var a=t.find(".load-animation");0==a.length?(a=$('<div class="load-animation"></div>'),a.prependTo(t).nextAll().hide()):a.show();var n=[],s=e.length;return function(t){return n.push(t),a.hide().nextAll().show(),n.length<s?i.callee:e.apply(null,n)}};t.default=n},f7f8f67a4d1dcb4de779:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a("7ab4a89ebadbfdecc2bf"),s=i(n),r=a("4602c3f5fe7ad9e3e91d"),l=i(r),o=a("b4fbf03f4f16003fe503"),d=(i(o),a("eca7a2561fa47d3f75f6")),u=i(d),c=a("b00a2728f54f5fed6ab0"),f=i(c),m=function(){function e(t){(0,s.default)(this,e),this.$element=$(t.element),this.$form=$(t.form),this.validator(),this.initfileChooser()}return(0,l.default)(e,[{key:"validator",value:function(){var e=this,t=this.$form.validate({currentDom:"#form-submit",ajax:!0,groups:{date:"minute second"},rules:{title:{required:!0,maxlength:50,trim:!0,course_title:!0},minute:"required unsigned_integer",second:"required second_range",mediaSource:"required"},messages:{minute:{required:Translator.trans("activity.video_manage.length_required_error_hint")},second:{required:Translator.trans("activity.video_manage.length_required_error_hint"),second_range:Translator.trans("validate.second_range.message")},mediaSource:Translator.trans("activity.video_manage.media_error_hint")},submitSuccess:function(e){cd.message({type:"success",message:Translator.trans("open_course.lesson.create_success")}),document.location.reload()},submitError:function(e){var t="",a=JSON.parse(e.responseText);a.error&&a.error.message&&(t=a.error.message),cd.message({type:"warning",message:Translator.trans("open_course.lesson.create_error")+":"+t})}});$("#form-submit").click(function(a){t.form()&&e.$form.submit()}),$(".js-length").blur(function(){if(t&&t.form()){var e=0|parseInt($("#minute").val()),a=0|parseInt($("#second").val());$("#length").val(60*e+a)}})}},{key:"initfileChooser",value:function(){var e=new u.default,t=new f.default(".js-subtitle-list"),a=function(e){if(u.default.closeUI(),e.length&&e.length>0){var a=parseInt(e.length/60),i=Math.round(e.length%60);$("#minute").val(a),$("#second").val(i),$("#length").val(60*a+i)}$("#mediaSource").val(e.source),"self"==e.source?($("#mediaId").val(e.id),$("#mediaUri").val(""),$("#mediaName").val(e.name)):($("#mediaUri").val(e.uri),$("#mediaId").val(0),$("#mediaName").val(e.name)),t.render(e)};this.$element.on("click",".js-choose-trigger",function(e){u.default.openUI(),$('[name="mediaSource').val(null)}),e.on("select",a)}}]),e}();t.default=m}},["573bea85e00feb665261"]);