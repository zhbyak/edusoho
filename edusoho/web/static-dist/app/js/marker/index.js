webpackJsonp(["app/js/marker/index"],{"4fc7bc177a8be8d19796":function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i("7ab4a89ebadbfdecc2bf"),n=a(r),s=i("4602c3f5fe7ad9e3e91d"),o=a(s);i("db9fa60e685f75e2d7f6");var l=i("82e9514f4e98661ef32b"),d=a(l),u=i("fe450c45f7142d95f6ed"),c=a(u),m=i("fe53252afd7b6c35cb73"),f=a(m),h=function(e,t,i){var a=new c.default({element:"#task-dashboard",initMarkerArry:e,_video_time:t,messenger:i,addScale:function(e,t,i){var a=$(".js-pane-question-content").data("queston-marker-add-url"),r={markerId:e.id,second:e.second,questionId:e.questionMarkers[0].questionId,seq:e.questionMarkers[0].seq};return $.post(a,r,function(a){void 0!=a.id&&(void 0==e.id&&(t.attr("id",a.markerId),i.push({id:a.markerId,time:e.second})),t.removeClass("hidden"),t.find(".item-lesson[question-id="+e.questionMarkers[0].questionId+"]").attr("id",a.id))}),e},mergeScale:function(e,t,i,a){var r=$(".js-pane-question-content").data("marker-merge-url");return $.post(r,{sourceMarkerId:e.id,targetMarkerId:e.merg_id},function(i){t.remove();for(var r in a)if(a[r].id==e.id){a.splice(r,1);break}}),e},updateScale:function(e,t){var i=$(".js-pane-question-content").data("marker-update-url"),a={id:e.id,second:e.second};return e.second&&$.post(i,a,function(e){}),e},deleteScale:function(e,t,i,r,n){var s=$(".js-pane-question-content").data("queston-marker-delete-url");$.post(s,{questionId:e.questionMarkers[0].id},function(r){if(i.remove(),$("#subject-lesson-list").find(".item-lesson[question-id="+e.questionMarkers[0].questionId+"]").removeClass("disdragg").addClass("drag"),t.find('[data-role="scale-blue-list"]').children().length<=0){t.remove();for(var s in n)if(n[s].id==t.attr("id")){n.splice(s,1);break}}else a.sortList(t.find('[data-role="scale-blue-list"]'))})},updateSeq:function(e,t){if(void 0!=t&&void 0!=t.questionMarkers&&0!=t.questionMarkers.length){for(var i=$(".js-pane-question-content").data("queston-marker-sort-url"),a=new Array,r=0;r<t.questionMarkers.length;r++)a.push(t.questionMarkers[r].id);$.post(i,{questionIds:a})}}});return a},v=function(){function e(t){(0,n.default)(this,e),this.$form=$(t.formSelect),this.$marker=$(t.markerSelect),this.init()}return(0,o.default)(e,[{key:"init",value:function(){this.initData(),this.initEvent()}},{key:"initData",value:function(){var e=this,t=parseInt((document.body.clientHeight-350)/50)>0?parseInt((document.body.clientHeight-350)/50):1;$.post(this.$form.attr("action"),this.$form.serialize()+"&pageSize="+t,function(i){$("#subject-lesson-list").html(i),$('[data-toggle="popover"]').popover(),f.default.get("MARK-MANGE-GUIDE")?(e.initDrag(),$("#step-1").removeClass("introhelp-icon-help")):e.initIntro(),f.default.set("MARK-MANGE-GUIDE","true",{expires:360,path:"/"}),e.$form.data("pageSize",t)})}},{key:"initIntro",value:function(){$(".js-introhelp-overlay").removeClass("hidden"),$(".show-introhelp").addClass("show");var e=$(".js-introhelp-img img"),t=document.createElement("img"),i=$(window).height()-e.offset().top-80;t.src=e.attr("src");var a=i*t.width/t.height/2+50;e.height(i),$(".js-introhelp-img").css("margin-left","-"+a+"px")}},{key:"initEvent",value:function(){var e=this;this.$marker.on("click",".js-question-preview",function(t){return e.onQuestionPreview(t)}),this.$marker.on("click",".js-more-questions",function(t){return e.onMoreQuestion(t)}),this.$marker.on("click",".js-close-introhelp",function(t){return e.onCloseHelp(t)}),this.$marker.on("click","#mark-form-submit",function(t){return e.onFormSubmit(t)}),this.$marker.on("change","#mark-form-target",function(t){return e.onChangeSelect(t)}),this.$marker.on("keydown","#mark-form-keyword",function(t){return e.onFormAutoSubmit(t)})}},{key:"onFormAutoSubmit",value:function(e){13==e.keyCode&&(e.preventDefault(),this.onFormSubmit(e))}},{key:"onFormSubmit",value:function(e){if(this.$form.validate().form()){var t=this.$form.data("pageSize");$.post(this.$form.attr("action"),this.$form.serialize()+"&pageSize="+t,function(e){$("#subject-lesson-list").html(e)})}}},{key:"onChangeSelect",value:function(e){this.onFormSubmit(e)}},{key:"onQuestionPreview",value:function(e){$.get($(e.currentTarget).data("url"),function(e){$(".modal").modal("show"),$(".modal").html(e)})}},{key:"onMoreQuestion",value:function(e){var t=$("select[name=target]"),i=$(e.currentTarget).hide().parent().addClass("loading"),a=$("#subject-lesson-list").css("max-height",$("#subject-lesson-list").height()),r=parseInt(i.data("current-page"))+1,n=i.data("last-page");$.post(i.data("url")+r,{target:t.val(),pageSize:this.$form.data("pageSize")},function(e){i.remove(),a.append(e).animate({scrollTop:40*(a.find(".item-lesson").length+1)}),r==n&&$(".js-more-questions").parent().remove()})}},{key:"onCloseHelp",value:function(e){$(e.currentTarget).closest(".show-introhelp").removeClass("show-introhelp"),$(".show-introhelp").height()<=0&&($(".js-introhelp-overlay").addClass("hidden"),this.initDrag())}},{key:"initDrag",value:function(){var e=[],t=30;$.ajax({type:"get",url:$(".js-pane-question-content").data("marker-metas-url"),cache:!1,async:!1,success:function(i){e=i.markersMeta,t=i.videoTime}}),h(e,t,d.default)}}]),e}();t.default=v},"518789458bb956f611e8":function(e,t,i){"use strict";var a=i("4fc7bc177a8be8d19796");new(function(e){return e&&e.__esModule?e:{default:e}}(a).default)({formSelect:".js-mark-form",markerSelect:".js-marker-manage-content"})},"82e9514f4e98661ef32b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("06597b47670159844043"),r=function(e){return e&&e.__esModule?e:{default:e}}(a),n=new r.default({name:"parent",project:"PlayerProject",children:[document.getElementById("viewerIframe")],type:"parent"});t.default=n},db9fa60e685f75e2d7f6:function(e,t,i){"use strict";var a=$("#task-dashboard"),r=a.data("media-player"),n="<iframe src='"+r+"' name='viewerIframe' id='viewerIframe' width='100%'allowfullscreen webkitallowfullscreen height='100%' style='border:0px'></iframe>";$("#task-video-content").html(n)},fe450c45f7142d95f6ed:function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i("7ab4a89ebadbfdecc2bf"),n=a(r),s=i("4602c3f5fe7ad9e3e91d"),o=a(s),l=i("9181c6995ae8c5c94b7a"),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(l),u=function(){function e(t){var i=t.element,a=t.initMarkerArry,r=void 0===a?[]:a,s=t._video_time,o=void 0===s?"18":s,l=t.messenger,d=void 0===l?{}:l,u=t.editbox,c=void 0===u?".editbox":u,m=(t.scalebox,t.timepartnum),f=void 0===m?"6":m,h=t.markers_array,v=void 0===h?new Array:h,g=t.addScale,p=t.mergeScale,k=t.updateScale,b=t.deleteScale,y=t.updateSeq;(0,n.default)(this,e),this.$element=$(i),this.initMarkerArry=r,this.markers_array=v,this._video_time=o,this.messenger=d,this.editbox=c,this.timepartnum=f,this.courseId=this.$element.data("course-id"),this.addScale=g,this.mergeScale=p,this.updateScale=k,this.deleteScale=b,this.updateSeq=y,this.init()}return(0,o.default)(e,[{key:"init",value:function(){this.initSortable(),this.initeditbox(!1),this.initMarker(this.initMarkerArry),this.lisentresize(),this.initPlayer(),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.$element.on("mousedown",".gruop-lesson-list .drag",function(t){return e.itemDraggable(t)}),this.$element.on("click",'.lesson-list [data-role="question-remove"]',function(t){return e.itemRmove(t)}),this.$element.on("click","#subject-lesson-list .item-lesson",function(t){return e.stopEvent(t)}),this.$element.on("mousedown",".scale-blue",function(t){return e.slideScale(t)}),this.$element.on("mouseenter",".scale-blue",function(t){return e.hoverScale(t)}),this.$element.on("mousedown",".js-question-preview",function(t){return e.previewMouseDown(t)})}},{key:"initPlayer",value:function(){var e=this.messenger,t=this,i=!0,a=$("#editbox-lesson-list");e.on("timechange",function(e){i&&$(".scale-white").css("left",t.getleft(e.currentTime))}),$(".scale-white").on("mousedown",function(r){i=!1,$(document).on("mousemove.playertime",function(i){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var r=i.pageX>a.width()+20?a.width()+20:i.pageX&&i.pageX<=20?20:i.pageX;$(".scale-white").css("left",r);var n=t.gettime(r);e.sendToChild({id:"viewerIframe"},"setCurrentTime",{time:n})}).on("mouseup.playertime",function(e){$(document).off("mousemove.playertime"),$(document).off("mousedown.playertime"),i=!0})})}},{key:"initSortable",value:function(){var e=this;$("#subject-lesson-list").sortable({group:"no-drop",drop:!1,delay:500,handle:".drag",onDrop:function(t,i,a){if(t.hasClass("item-lesson")){a(t,i);var r=t.closest(".scale.blue");r.find(".lesson-list .item-lesson").length>0&&(e.sortList(r.find(".lesson-list")),e.addScale(r,r.find(".time").html(),r.css("left"),r.find(".lesson-list").children().length))}}}),$("#editbox-lesson-list").sortable({group:"no-drop",drag:!1})}},{key:"sortList",value:function(e){var t=1;e.find(".item-lesson").each(function(){$(this).find('[data-role="sqe-number"]').text(t),t++})}},{key:"addScale",value:function(e,t,i,a){var r=e.find("li:last"),n={id:e.attr("id"),second:t,questionMarkers:[{id:r.attr("id"),seq:i,questionId:r.attr("question-id")}]};$.extend(this.addScale(n,e,a))}},{key:"initeditbox",value:function(e){var t=this,i=$(t.editbox);if(e)i.find(".scale.scale-default:visible").each(function(){$(this).css("left",t.getleft(d.time2Sec($(this).find('[data-role="scale-time"]').text())))}),i.find(".scale.scale-blue:visible").each(function(){$(this).css("left",t.getleft(d.time2Sec($(this).find('[data-role="scale-blue-time"]').text())))});else for(var a=t.timepartnum,r=t._video_time/a,n=0;n<=a;n++){var s=$('[data-role="scale-default"]').clone().css("left",t.getleft(r*n)).removeClass("hidden").removeAttr("data-role");s.find('[data-role="scale-time"]').text(d.sec2Time(Math.round(r*n))),$('[data-role="scale-default"]').before(s)}}},{key:"initMarker",value:function(e){if(e.length>0){for(var t=$('[data-role="scale-blue"]'),i=0;i<e.length;i++){for(var a=t.clone().css("left",this.getleft(e[i].second)).removeAttr("data-role").removeClass("hidden").attr("id",e[i].id),r=(a.find('[data-role="scale-blue-time"]').text(d.sec2Time(e[i].second)),e[i].questionMarkers),n=a.find('[data-role="scale-blue-item"]'),s=0;s<r.length;s++){var o=n.clone().removeAttr("data-role").attr({"question-id":r[s].questionId,id:r[s].id});o.data("url","/course/"+this.courseId+"/question/"+r[s].questionId+"/marker/preview").find('[data-role="sqe-number"]').text(s+1).end().find('[data-role="question-type"]').text(Translator.trans("course.question.type.single_choice")).end().find('[data-role="question-info"]').text(r[s].stem.replace(/<.*?>/gi,"")),n.before(o)}t.after(a),n.remove(),this.markers_array.push({id:e[i].id,time:e[i].second})}this.newSortList($(this.scalebox).find('[data-role="scale-blue-list"]'))}}},{key:"lisentresize",value:function(){var e=this;$(window).resize(function(){e.initeditbox(!0)})}},{key:"getleft",value:function(e){return e*$("#editbox-lesson-list").width()/parseInt(this._video_time)+20}},{key:"newSortList",value:function(e){var t=this;e.sortable({delay:500,itemSelector:".item-lesson",onDrop:function(e,i,a){a(e,i),t.maskShow(!1);var r=e.closest(".scale-blue"),n={id:"",questionMarkers:[]};n.id=r.attr("id"),t.sortList(r.find('[data-role="scale-blue-list"]')),r.find("li").each(function(){var e={id:$(this).attr("id"),seq:$(this).find('[data-role="sqe-number"]').html()};n.questionMarkers.push(e)}),t._updateSeq(r,n),r.removeClass("moveing")},serialize:function(e,t,i){return i?t:e.attr("id")},isValidTarget:function(e,i){return t.maskShow(!0),e.closest(".scale-blue").addClass("moveing"),!0}})}},{key:"maskShow",value:function(e){e?$('[data-role="player-mask"]').removeClass("hidden"):$('[data-role="player-mask"]').addClass("hidden")}},{key:"gettime",value:function(e){return Math.round((e-20)*this._video_time/$("#editbox-lesson-list").width())}},{key:"itemDraggable",value:function(e){var t=this,i=[],a=null,r=null,n=null,s=$(e.currentTarget),o=$("#editbox-lesson-list"),l=$('[data-role="scale-red"]'),u=l.find('[data-role="scale-red-details"]'),c=s.clone().removeClass("drag").addClass("disdragg");s.after(c),t.maskShow(!0),$(document).on("mousemove.dragitem",function(e){if(o.find(".placeholder").length<=0)return l.addClass("hidden"),void o.removeClass("highlight");if(o.addClass("highlight"),r=e.pageX>o.width()+20?o.width()+20:e.pageX&&e.pageX<=20?20:e.pageX,n=t.gettime(r),u.text(d.sec2Time(n)),l.removeClass("hidden").css("left",r),t.markers_array.length>0){$(".scale-blue").removeClass("highlight"),i=[],a=null;for(var s in t.markers_array)if(Math.abs(t.markers_array[s].time-n)<=5)return i=[{id:t.markers_array[s].id,time:t.markers_array[s].time}],void(a=$(".scale-blue[id="+t.markers_array[s].id+"]").addClass("highlight"))}}).on("mouseup.dragitem",function(e){$(document).off("mousemove.dragitem"),$(document).off("mouseup.dragitem"),t.maskShow(!1),l.addClass("hidden"),o.removeClass("highlight");var s=o.find(".item-lesson");if(s.length<=0)return l.addClass("hidden"),o.removeClass("highlight"),void c.remove();if(i.length>0){var u=a.find('[data-role="scale-blue-list"]');s.appendTo(u).find('[data-role="sqe-number"]').text(u.children().length),t._addScale(a,i[0].time,u.children().length,t.markers_array),a.removeClass("highlight"),t.newSortList(u)}else{var m=$('[data-role="scale-blue"]'),f=m.clone().css("left",r).removeAttr("data-role"),h=f.find('[data-role="scale-blue-list"]');f.find('[data-role="scale-blue-time"]').text(d.sec2Time(n));h.children().remove(),h.append(s),m.after(f),t._addScale(f,n,1,t.markers_array)}})}},{key:"itemRmove",value:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.closest('[data-role="scale-blue-list"]'),a=t.closest("li"),r=t.closest(".scale-blue");this._deleteScale(r,a,i.children().length,this.markers_array)}},{key:"stopEvent",value:function(e){e.stopPropagation()}},{key:"slideScale",value:function(e){var t=this,i=[],a=null,r=null,n=null,s=$(e.currentTarget),o=$("#editbox-lesson-list");s.css("left");t.maskShow(!0),$(".marker-manage").addClass("slideing"),s.addClass("moveing"),$(document).on("mousemove.slide",function(e){if(window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),r=e.pageX>o.width()+20?o.width()+20:e.pageX&&e.pageX<=20?20:e.pageX,n=Math.round((r-20)*t._video_time/o.width()),s.css("left",r),s.find('[data-role="scale-blue-time"]').text(d.sec2Time(n)),t.markers_array.length>0){$(".scale-blue").removeClass("highlight"),i=[],a=null;for(var l in t.markers_array)if(Math.abs(t.markers_array[l].time-n)<=5&&s.attr("id")!=t.markers_array[l].id)return i=[{id:t.markers_array[l].id,time:t.markers_array[l].time}],void(a=$(".scale-blue[id="+t.markers_array[l].id+"]").addClass("highlight"))}}).on("mouseup.slide",function(e){if($(document).off("mousemove.slide"),$(document).off("mouseup.slide"),t.maskShow(!1),s.removeClass("moveing"),$(".marker-manage").removeClass("slideing"),i.length>0){var r=a.find('[data-role="scale-blue-list"]');r.append(s.find('[data-role="scale-blue-list"]').children()),t.sortList(r),a.removeClass("highlight"),t._mergeScale(s,a,t.markers_array)}else t._updateScale(s,n)})}},{key:"hoverScale",value:function(e){var t=$(e.currentTarget);t.offset().left-20<110?t.find(".scale-details").css("margin-left","-"+(t.offset().left-20)+"px"):t.find(".scale-details").css("margin-left","-110px")}},{key:"previewMouseDown",value:function(e){e.stopPropagation()}},{key:"_addScale",value:function(e,t,i,a){var r=e.find("li:last"),n={id:e.attr("id"),second:t,questionMarkers:[{id:r.attr("id"),seq:i,questionId:r.attr("question-id")}]};$.extend(this.addScale(n,e,a))}},{key:"_mergeScale",value:function(e,t,i){var a={id:e.attr("id"),merg_id:t.attr("id")};$.extend(this.mergeScale(a,e,t,i))}},{key:"_updateScale",value:function(e,t){var i={id:e.attr("id"),second:t};$.extend(this.updateScale(i,e))}},{key:"_deleteScale",value:function(e,t,i,a){var r={id:e.attr("id"),questionMarkers:[{id:t.attr("id"),seq:t.find('[data-role="sqe-number"]').html(),questionId:t.attr("question-id")}]};$.extend(this.deleteScale(r,e,t,i,a))}},{key:"_updateSeq",value:function(e,t){$.extend(this.updateSeq(e,t))}}]),e}();t.default=u}},["518789458bb956f611e8"]);