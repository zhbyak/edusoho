webpackJsonp([4],{"13mi":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("Dd8w"),a=o.n(r),n=o("Xxa5"),i=o.n(n),s=(o("eqfM"),o("/QYm")),c=o("exGp"),l=o.n(c),u=o("NyOD"),d=o("1JqO"),p=o("Du/2"),h=o("gyMJ"),v=o("NYxO"),f={mixins:[u.a,d.a],name:"social-wx",created:function(){var r=this;return l()(i.a.mark(function e(){var t,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.$store.state.token){e.next=9;break}if(1==localStorage.getItem("first_direct"))return r.$router.replace({path:r.$route.query.redirect||"/"}),e.abrupt("return");e.next=5;break;case 5:return s.a.loading({message:"请稍后"}),r.afterLogin(),localStorage.setItem("first_direct",1),e.abrupt("return");case 9:if(t=localStorage.getItem("socialBinded_wx")?JSON.parse(localStorage.getItem("socialBinded_wx")):r.socialBinded.wx,r.setSocialStatus({key:"wx",status:t}),o=location.search.match(/\?code.*&/g)){e.next=16;break}return localStorage.setItem("first_direct",0),r.wxLogin(),e.abrupt("return");case 16:return s.a.loading({message:"正在登录"}),o=o[0].slice(6,-1),e.next=20,h.a.login({params:{code:o,type:"weixinmob"}}).then(function(e){r.userLogin(e),s.a.clear(),s.a.success({duration:2e3,message:"登录成功"});var t=r.socialBinded.wx?-2:-7;r.$route.query.callbackType&&(t+=1),localStorage.setItem("socialBinded_wx",!0),r.$router.go(t)}).catch(function(e){localStorage.setItem("socialBinded_wx",!1),window.location.href="/login/bind/weixinmob?os=h5&_target_path="+encodeURIComponent(location.pathname+location.hash)});case 20:case"end":return e.stop()}},e,r)}))()},computed:a()({},Object(v.mapState)(["socialBinded"])),methods:a()({},Object(v.mapMutations)({setSocialStatus:p.m,userLogin:p.s}),{wxLogin:function(){s.a.loading({message:"请稍后"});var e=encodeURIComponent(location.origin+location.pathname+location.hash);window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.$route.query.weixinmob_key+"&redirect_uri="+e+"&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect"}})},m={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]},g=o("VU/8")(f,m,!1,null,null,null);t.default=g.exports},uoNF:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("gyMJ"),a={data:function(){return{code:"",popupShow:!1,closeOnClickOverlay:!1,btnDisable:!0,isErrorCode:!1,errorText:"",courseId:"",courseTitle:""}},watch:{code:function(e,t){var o=e.length-t.length;if(8<Math.abs(o)){var r=this.spliceCode(e);this.code=r||e,this.isErrorCode=!1,this.btnDisable=!1,this.errorText=""}}},methods:{spliceCode:function(e){var t=/[a-z0-9A-Z]{8}/;return!!e.match(t)&&e.match(t)[0]},checkCodeChange:function(e){if(7<e.length){return/^[a-z0-9A-Z]{8}$/.test(e)?(this.isErrorCode=!1,this.btnDisable=!1,void(this.errorText="")):(this.isErrorCode=!0,void(this.errorText="8位数字、英文字母组成"))}this.isErrorCode=!1,this.btnDisable=!0,this.errorText=""},codeCovert:function(t){var o=this;r.a.couponCheck({query:{code:t}}).then(function(e){if(!1===e.success||e.error)return o.isErrorCode=!0,void(o.errorText=e.error.message);r.a.exchangeCoupon({query:{code:t}}).then(function(e){o.courseId=e.products[0].course.id,o.courseTitle=e.products[0].course.displayedTitle,o.popupShow=!0}).catch(function(e){o.isErrorCode=!0,o.errorText=e.message})})},toStudy:function(){var e=this.courseId;if(e){var t=encodeURIComponent("/my/orders");this.$router.push({path:"/course/"+e+"?backUrl="+t})}}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"coupon-covert-container"},[o("h2",{staticClass:"title"},[t._v("兑换卡券")]),t._v(" "),o("van-field",{class:[{"error-code":t.isErrorCode},"e-input","coupon-input"],attrs:{placeholder:"请输入8位兑换码",clearable:""},on:{input:function(e){t.checkCodeChange(t.code)}},model:{value:t.code,callback:function(e){t.code="string"==typeof e?e.trim():e},expression:"code"}}),t._v(" "),t.isErrorCode?o("span",{staticClass:"error-code text-14"},[t._v(t._s(t.errorText))]):t._e(),t._v(" "),o("van-button",{staticClass:"covert-submit",attrs:{type:"info",disabled:t.btnDisable||t.isErrorCode},on:{click:function(e){t.codeCovert(t.code)}}},[t._v("确认")]),t._v(" "),o("van-popup",{staticClass:"coupon-covert-popup",attrs:{closeOnClickOverlay:t.closeOnClickOverlay},model:{value:t.popupShow,callback:function(e){t.popupShow=e},expression:"popupShow"}},[o("div",{staticClass:"modal-content"},[t._v("\n      兑换成功"),o("div",[t._v("恭喜您获得"+t._s(t.courseTitle)+"课程")])]),t._v(" "),o("div",{staticClass:"color-primary mt10 text-15",on:{click:t.toStudy}},[t._v("去学习")])])],1)},staticRenderFns:[]},i=o("VU/8")(a,n,!1,null,null,null);t.default=i.exports}});