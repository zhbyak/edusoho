webpackJsonp([14],{P8if:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("Dd8w"),a=i.n(n),s=i("jW8y"),r=i("gMS5"),o=i("NYxO"),c=i("Du/2"),u={components:{Directory:s.a,DetailHead:r.a},computed:a()({},Object(o.mapState)("course",{details:function(e){return e.details}}),Object(o.mapState)({isLoading:function(e){return e.isLoading}})),beforeRouteLeave:function(e,t,i){this.$store.commit("course/"+c.n,{sourceType:"img"}),i()}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"course-detail try"},[e.isLoading?i("e-loading"):e._e(),e._v(" "),i("detail-head",{attrs:{courseSet:e.details.courseSet}}),e._v(" "),i("directory",{attrs:{hiddeTitle:!0,courseItems:e.details.courseItems}})],1)},staticRenderFns:[]},l=i("VU/8")(u,d,!1,null,null,null);t.default=l.exports},gMS5:function(e,t,i){"use strict";var n=i("//Fk"),a=i.n(n),s=i("Xxa5"),r=i.n(s),o=(i("XmAh"),i("il3B")),c=i("woOf"),u=i.n(c),d=(i("eqfM"),i("/QYm")),l=i("exGp"),p=i.n(l),v=i("Dd8w"),h=i.n(v),m=i("PirY"),y=i.n(m),f=i("NYxO"),g=i("gyMJ"),w=i("lpC9"),_=i("qnZR"),D=i("OFf3"),P=i.n(D),S={components:{countDown:w.a,tagLink:_.a},data:function(){return{isEncryptionPlus:!1,mediaOpts:{},isCoverOpen:!1,isPlaying:!1,player:null,counting:!0,isEmpty:!1,tagData:{earnings:0,isShow:!1,link:"",className:"course-tag",minDirectRewardRatio:0},bindAgencyRelation:{}}},props:{courseSet:{type:Object,default:function(){return{}}},seckillActivities:{type:Object,default:null}},computed:h()({},Object(f.mapState)("course",{sourceType:function(e){return e.sourceType},selectedPlanId:function(e){return e.selectedPlanId},taskId:function(e){return e.taskId},details:function(e){return e.details},joinStatus:function(e){return e.joinStatus},user:function(e){return e.user}}),{textContent:function(){return this.mediaOpts.text}}),watch:{taskId:function(e,t){("course"!==this.$route.name||this.joinStatus)&&0<e&&this.initHead()}},created:function(){this.initHead(),this.showTagLink(),this.initTagData()},methods:{initHead:function(){["video","audio"].includes(this.sourceType)&&(window.scrollTo(0,0),this.initPlayer())},viewAudioDoc:function(){this.isCoverOpen=!0},hideAudioDoc:function(){this.isCoverOpen=!1},handlePlayer:function(){return this.isPlaying?this.player&&this.player.pause():this.player&&this.player.play()},getParams:function(){return!this.joinStatus?{query:{courseId:this.selectedPlanId,taskId:this.taskId},params:{preview:1}}:{query:{courseId:this.selectedPlanId,taskId:this.taskId}}},initPlayer:function(){var s=this;return p()(r.a.mark(function e(){var t,i,n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s.$refs.video&&(s.$refs.video.innerHTML=""),e.next=3,g.a.getMedia(s.getParams()).catch(function(e){var t=Number(s.details.id);4040101==e.code&&s.$router.push({name:"login",query:{redirect:"/course/"+t}}),d.a.fail(e.message)});case 3:if(t=e.sent){e.next=7;break}return e.abrupt("return");case 7:if("video"!==t.mediaType||t.media.url){e.next=10;break}return Object(d.a)("课程内容准备中，请稍候查看"),e.abrupt("return");case 10:if(i=t.media.timeLimit,s.isEncryptionPlus=t.media.isEncryptionPlus,t.media.isEncryptionPlus)return Object(d.a)("该浏览器不支持云视频播放，请下载App"),e.abrupt("return");e.next=15;break;case 15:n=t.media,a={id:"course-detail__head--video",user:s.user,playlist:n.url,autoplay:!0,disableFullscreen:"audio"===s.sourceType,isAudio:"audio"===s.sourceType,strictMode:!n.supportMobile,pluck:{timelimit:i},resId:n.resId,disableDataUpload:!0},!s.joinStatus&&Number(s.details.tryLookable)||delete a.pluck,s.mediaOpts=u()({text:t.media.text},a),s.$store.commit("UPDATE_LOADING_STATUS",!0),s.loadPlayerSDK().then(function(e){s.$store.commit("UPDATE_LOADING_STATUS",!1);var t=new e(a);t.on("playing",function(){s.isPlaying=!0}),t.on("unablePlay",function(){s.$refs.video.innerHTML="",o.a.alert({message:"当前内容不支持该手机浏览器观看，建议您使用Chrome、Safari浏览器观看。"}).then(function(){})}),t.on("paused",function(){s.isPlaying=!1}),s.player=t});case 22:case"end":return e.stop()}},e,s)}))()},loadPlayerSDK:function(){if(window.VideoPlayerSDK)return a.a.resolve(window.VideoPlayerSDK);var e="//service-cdn.qiqiuyun.net/js-sdk/video-player/sdk-v1.js?v="+Date.now()/1e3/60;return new a.a(function(t,i){y()(e,function(e){e&&i(e),t(window.VideoPlayerSDK)})})},expire:function(){this.counting=!1},sellOut:function(){this.isEmpty=!0,this.$emit("goodsEmpty")},showTagLink:function(){var t=this;g.a.hasDrpPluginInstalled().then(function(e){e.Drp?g.a.getAgencyBindRelation().then(function(e){e.agencyId?(t.bindAgencyRelation=e,t.tagData.isShow=!0):t.tagData.isShow=!1}):t.tagData.isShow=!1})},initTagData:function(){var n=this;g.a.getDrpSetting().then(function(e){n.drpSetting=e,n.tagData.minDirectRewardRatio=e.minDirectRewardRatio;var t={type:"course",id:n.details.id,merchant_id:n.drpSetting.merchantId};n.tagData.link=n.drpSetting.distributor_template_url+"?"+P.a.stringify(t);var i=n.drpSetting.minDirectRewardRatio/100*n.details.price;n.tagData.earnings=(Math.floor(100*i)/100).toFixed(2)})}}},b={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"course-detail__head pos-rl",attrs:{id:"course-detail__head"}},[e.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(e.sourceType)&&!e.isEncryptionPlus&&!e.isCoverOpen,expression:"['audio'].includes(sourceType) && !isEncryptionPlus && !isCoverOpen"}],staticClass:"course-detail__nav--btn",on:{click:e.viewAudioDoc}},[e._v("\n    文稿\n  ")]):e._e(),e._v(" "),e.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(e.sourceType)&&!e.isEncryptionPlus,expression:"['audio'].includes(sourceType) && !isEncryptionPlus"}],staticClass:"course-detail__nav--cover web-view",class:{opened:e.isCoverOpen}},[i("div",{staticClass:"media-text",domProps:{innerHTML:e._s(e.textContent)}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isCoverOpen,expression:"isCoverOpen"}],staticClass:"course-detail__nav--cover-control",on:{click:e.handlePlayer}},[i("i",{staticClass:"h5-icon",class:e.isPlaying?"h5-icon-zanting":"h5-icon-bofang"})]),e._v(" "),i("div",{staticClass:"course-detail__nav--cover-close-btn",on:{click:e.hideAudioDoc}},[i("i",{staticClass:"van-icon van-icon-arrow van-nav-bar__arrow"})])]):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"img"===e.sourceType||e.isEncryptionPlus,expression:"sourceType === 'img' || isEncryptionPlus"}],staticClass:"course-detail__head--img",attrs:{id:"course-detail__head--img"}},[e.courseSet.cover?i("img",{attrs:{src:e.courseSet.cover.large,alt:""}}):e._e(),e._v(" "),e.seckillActivities&&"ongoing"===e.seckillActivities.status&&e.counting&&!e.isEmpty?i("countDown",{attrs:{activity:e.seckillActivities},on:{timesUp:e.expire,sellOut:e.sellOut}}):e._e()],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:["video","audio"].includes(e.sourceType)&&!e.isEncryptionPlus,expression:"['video', 'audio'].includes(sourceType) && !isEncryptionPlus"}],ref:"video",attrs:{id:"course-detail__head--video"}}),e._v(" "),i("tagLink",{attrs:{tagData:e.tagData}})],1)},staticRenderFns:[]},k=i("VU/8")(S,b,!1,null,null,null);t.a=k.exports}});