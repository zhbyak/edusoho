webpackJsonp([3],{NDEt:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Xxa5"),n=e.n(i),s=e("woOf"),r=e.n(s),c=(e("eqfM"),e("/QYm")),o=e("exGp"),l=e.n(o),d=e("Dd8w"),p=e.n(d),y=e("gyMJ"),u=(e("mtWM"),e("NYxO")),h={data:function(){return{detail:{},payWay:"",selected:!0,paySettings:{},inWechat:this.isWeixinBrowser(),targetType:this.$route.query.targetType,timeoutId:-1}},computed:p()({},Object(u.mapState)(["wechatSwitch","isLoading"]),{validPayWay:function(){return this.paySettings.wxpayEnabled||this.paySettings.alipayEnabled&&!this.inWechat}}),created:function(){var s=this;return l()(n.a.mark(function t(){var a,e,i;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.a.getSettings({query:{type:"payment"}}).catch(function(t){c.a.fail(t.message)});case 2:s.paySettings=t.sent,s.paySettings.alipayEnabled&&!s.inWechat?s.payWay="Alipay_LegacyH5":s.paySettings.wxpayEnabled&&(s.payWay="WechatPay_H5"),a=s.$route.query,a.source,a.id,e=a.sn,i=a.targetId,y.a.getOrderDetail({query:{sn:e}}).then(function(t){if("success"===t.status&&i){if(s.wechatSwitch)return void s.$router.replace({path:"/pay_success",query:{targetType:s.targetType,targetId:i}});s.$router.push({path:"/"+s.targetType+"/"+i})}s.detail=r()({},t)}).catch(function(t){c.a.fail(t.message)});case 6:case"end":return t.stop()}},t,s)}))()},beforeRouteLeave:function(t,a,e){clearTimeout(this.timeoutId),e()},methods:{handlePay:function(){var a=this;this.validPayWay&&("WechatPay_H5"===this.payWay&&this.inWechat?window.location.href=window.location.origin+"/pay/center/wxpay_h5?pay_amount="+this.detail.pay_amount+"&title="+this.detail.title+"&sn="+this.detail.sn:y.a.createTrade({data:{gateway:this.payWay,type:"purchase",orderSn:this.detail.sn,app_pay:"Y"}}).then(function(t){"WechatPay_H5"!==a.payWay?window.location.href=t.payUrl:a.getTradeInfo(t.tradeSn).then(function(){window.location.href=t.mwebUrl})}).catch(function(t){c.a.fail(t.message)}))},isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())},getTradeInfo:function(a){var e=this;return y.a.getTrade({query:{tradesSn:a}}).then(function(t){if(t.isPaid)return e.wechatSwitch?void e.$router.replace({path:"/pay_success",query:{paidUrl:window.location.origin+t.paidSuccessUrlH5}}):void(window.location.href=window.location.origin+t.paidSuccessUrlH5);e.timeoutId=setTimeout(function(){e.getTradeInfo(a)},2e3)}).catch(function(t){c.a.fail(t.message)})}}},_={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"payPage"},[a.isLoading?e("e-loading"):a._e(),a._v(" "),e("div",{staticClass:"payPage__order"},[e("div",{staticClass:"order__head order--line"},[a._v("\n      支付方式\n    ")]),a._v(" "),e("div",{staticClass:"order__infomation"},[e("div",{staticClass:"title"},[a._v(a._s(a.detail.title))]),a._v(" "),e("div",{staticClass:"sum"},[e("span",[a._v("待支付")]),a._v(" "),e("span",{staticClass:"sum__price"},[a._v("¥ "),e("span",{staticClass:"num"},[a._v(a._s(a._f("toMoney")(a.detail.pay_amount)))])])]),a._v(" "),e("div",{staticClass:"payWay"},[e("div",{directives:[{name:"show",rawName:"v-show",value:a.paySettings.alipayEnabled&&!a.inWechat,expression:"paySettings.alipayEnabled && !inWechat"}],class:["payWay__item",{"payWay__item--selected":"Alipay_LegacyH5"===a.payWay}],on:{click:function(t){a.payWay="Alipay_LegacyH5",a.selected=!0}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),a._v(" "),e("div",{staticClass:"right"}),a._v(" "),e("img",{attrs:{src:"static/images/zfb.png"}})]),a._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:a.paySettings.wxpayEnabled,expression:"paySettings.wxpayEnabled"}],class:["payWay__item",{"payWay__item--selected":"WechatPay_H5"===a.payWay}],on:{click:function(t){a.payWay="WechatPay_H5",a.selected=!1}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),a._v(" "),e("div",{staticClass:"right"}),a._v(" "),e("img",{attrs:{src:"static/images/wx.png"}})])])])]),a._v(" "),e("div",{class:["payPage__payBtn",{disabled:!a.validPayWay}],on:{click:a.handlePay}},[a._v("\n    "+a._s(a.validPayWay?"立即支付":"无可用支付方式")+"\n  ")])],1)},staticRenderFns:[]},g=e("VU/8")(h,_,!1,null,null,null);a.default=g.exports},q3mx:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Dd8w"),s=e.n(i),n=(e("gyMJ"),e("NYxO")),r={data:function(){return{targetId:this.$route.query.targetId||"",targetType:this.$route.query.targetType||"",paidUrl:this.$route.query.paidUrl}},computed:s()({},Object(n.mapState)(["wechatSwitch","wechatSettings"])),created:function(){this.wechatSwitch||this.$router.replace({path:"/"})},methods:{backToCourse:function(){this.paidUrl?window.location.href=this.paidUrl:this.$router.replace({path:"/"+this.targetType+"/"+this.targetId})}}},c={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"pay-success-container"},[t._m(0),t._v(" "),t.wechatSettings?e("div",{staticClass:"qrcode-img-container"},[e("img",{attrs:{src:t.wechatSettings.official_qrcode,alt:""}})]):t._e(),t._v(" "),t._m(1),t._v(" "),e("van-button",{staticClass:"btn-back-course",attrs:{type:"primary"},on:{click:t.backToCourse}},[t._v("返回课程")])],1)},staticRenderFns:[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"pay-success-text"},[e("i",{staticClass:"h5-icon h5-icon-check"}),t._v(" "),e("span",{staticClass:"text-18 success-text"},[t._v("支付成功！")]),t._v(" "),e("div",{staticClass:"mt5 text-14 color-red"},[t._v("为享受更好的教学服务，建议您开启课程通知。")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"press-img-container"},[a("img",{attrs:{src:"static/images/wechat_press.png",alt:""}}),this._v(" "),a("div",{staticClass:"press-text text-14"},[this._v("请长按二维码开启课程通知")])])}]},o=e("VU/8")(r,c,!1,null,null,null);a.default=o.exports}});