webpackJsonp([21],{YG7V:function(e,t){},pFAW:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("//Fk"),o=n.n(i),a=n("fZjL"),s=n.n(a),r=n("mvHQ"),c=n.n(r),u=n("woOf"),l=n.n(u),h=(n("eqfM"),n("/QYm")),d=(n("XmAh"),n("il3B")),m=n("Dd8w"),f=n.n(m),w=n("bOdI"),p=n.n(w),v=n("gyMJ"),k=n("Du/2"),g=n("NYxO"),I=n("acEQ"),b=n("0Otq"),y=n("VVIM"),T=n("mtMv"),_="",S={name:"homework-do",mixins:[y.a,T.a],data:function(){var e;return e={info:[],answer:{},lastAnswer:null,cardSeq:0,homework:null,cardShow:!1,localanswerName:null,localtimeName:null,lastUsedTime:null},p()(e,"lastAnswer",null),p()(e,"usedTime",null),p()(e,"isHandHomework",!1),p()(e,"slideIndex",0),e},components:{itemBank:b.a,guidePage:I.a},computed:f()({},Object(g.mapState)({isLoading:function(e){return e.isLoading},user:function(e){return e.user}})),watch:{answer:{handler:"saveAnswer",deep:!0}},created:function(){this.getData()},beforeRouteEnter:function(e,t,n){_="/"===t.fullPath?"/":"",n()},beforeRouteLeave:function(e,t,n){0==this.info.length||this.isHandHomework||"doing"!=this.homework.status?n():this.submitpaper().then(function(){n()}).catch(function(){n(!1)})},beforeDestroy:function(){this.clearTime(),d.a.close()},methods:f()({},Object(g.mapMutations)({setNavbarTitle:k.k}),Object(g.mapActions)("course",["handHomeworkdo"]),{getData:function(){var n=this,e=this.$route.query.homeworkId,t=this.$route.query.targetId;this.$route.query.action;v.a.getHomeworkInfo({query:{homeworkId:e},data:{targetId:t,targetType:"task"}}).then(function(e){n.afterGetData(e)}).catch(function(e){var t=h.a.fail(e.message);"4036706"==e.code&&setTimeout(function(){n.toIntro(),t.clear()},2e3)})},afterGetData:function(e){this.setNavbarTitle(e.paperName),this.homework=e,this.isDoing()||(this.getLocalData(),this.formatData(e),this.interruption(),this.saveTime())},isDoing:function(){return"doing"!=this.homework.status&&(this.showResult(),!0)},interruption:function(){var n=this;this.$route.params.KeepDoing||this.canDoing(this.homework,this.user.id).then(function(){}).catch(function(e){var t=e.answer;n.submitHomework(t)})},formatData:function(e){var o=this;e.items.forEach(function(i){if("material"!=i.type){var e=o.sixType(i.type,i,o.lastAnswer);o.$set(o.answer,i.id,e.answer),o.info.push(e.item)}if("material"==i.type){var a=l()({},i,{subs:""});i.subs.forEach(function(e,t){e.parentTitle=a,e.parentType=i.type,e.materialIndex=t+1;var n=o.sixType(e.type,e,o.lastAnswer);o.$set(o.answer,e.id,n.answer),o.info.push(n.item)})}})},formatStatus:function(e,t){var n=0;return("single_choice"==e||"choice"==e||"uncertain_choice"==e||"determine"==e)&&0<this.answer[t].length?n=1:"essay"==e&&""!=this.answer[t][0]?n=1:"fill"==e?n=Number(this.answer[t].some(function(e){return""!=e})):n},slideToNumber:function(e){var t=Number(e);this.cardSeq=t,this.cardShow=!1},getLocalData:function(){this.localanswerName="homework-"+this.user.id+"-"+this.homework.id,this.localuseTime="homework-"+this.user.id+"-"+this.homework.id+"-usedTime",this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName))},saveAnswer:function(e){localStorage.setItem(this.localanswerName,c()(e))},saveTime:function(){var e=this,t=localStorage.getItem(this.localuseTime)||0;this.usedTime=setInterval(function(){localStorage.setItem(e.localuseTime,++t)},1e3)},clearTime:function(){clearInterval(this.usedTime),this.usedTime=null},submitpaper:function(){var e=this,t=0,i="题目已经做完，确认提交吗?",a=JSON.parse(c()(this.answer));return s()(a).forEach(function(e){a[e]=a[e].filter(function(e){return""!==e}),0===a[e].length&&t++}),0<t&&(i="还有"+t+"题未做，确认提交吗？"),new o.a(function(t,n){d.a.confirm({title:"提交",cancelButtonText:"立即提交",confirmButtonText:"检查一下",message:i}).then(function(){e.cardShow=!0,n()}).catch(function(){e.clearTime(),e.submitHomework(a).then(function(e){t()}).catch(function(e){n()})})})},submitHomework:function(t){var a=this;t||(t=JSON.parse(c()(this.answer)),s()(t).forEach(function(e){t[e]=t[e].filter(function(e){return""!==e})}));var e={answer:t,homeworkId:this.$route.query.homeworkId,userId:this.user.id,homeworkResultId:this.homework.id};return new o.a(function(n,i){a.handHomeworkdo(e).then(function(e){a.isHandHomework=!0,n(),a.showResult()}).catch(function(e){var t=h.a.fail(e.message);"4036705"==e.code?setTimeout(function(){a.isHandHomework=!0,t.clear(),n(),a.showResult()},2e3):i()})})},showResult:function(){this.$router.replace({name:"homeworkResult",query:{homeworkId:this.$route.query.homeworkId,homeworkResultId:this.homework.id,taskId:this.$route.query.targetId,backUrl:_,courseId:this.$route.query.courseId}})},toIntro:function(){this.$router.replace({name:"homeworkIntro",query:{courseId:this.$route.query.courseId,taskId:this.$route.query.targetId,backUrl:_}})}})},q={render:function(){var n=this,e=n.$createElement,i=n._self._c||e;return i("div",{staticClass:"paper-swiper"},[n.isLoading?i("e-loading"):n._e(),n._v(" "),0<n.info.length?i("item-bank",{attrs:{current:n.cardSeq,info:n.info,answer:n.answer,showScore:!1,slideIndex:n.slideIndex,all:n.info.length},on:{"update:current":function(e){n.cardSeq=e},"update:answer":function(e){n.answer=e},"update:slideIndex":function(e){n.slideIndex=e}}}):n._e(),n._v(" "),i("guide-page"),n._v(" "),i("div",{staticClass:"paper-footer"},[i("div",[i("span",{on:{click:function(e){n.cardShow=!0}}},[i("i",{staticClass:"iconfont icon-Questioncard"}),n._v("\n        题卡\n      ")])]),n._v(" "),i("div",[i("span",{on:{click:n.submitpaper}},[i("i",{staticClass:"iconfont icon-submit"}),n._v("\n        提交\n      ")])])]),n._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:n.cardShow,callback:function(e){n.cardShow=e},expression:"cardShow"}},[0<n.info.length?i("div",{staticClass:"card"},[i("div",{staticClass:"card-title"},[i("div",[i("span",{staticClass:"card-finish"},[n._v("已完成")]),n._v(" "),i("span",{staticClass:"card-nofinish"},[n._v("未完成")])]),n._v(" "),i("i",{staticClass:"iconfont icon-no",on:{click:function(e){n.cardShow=!1}}})]),n._v(" "),i("div",{staticClass:"card-list"},[i("div",{staticClass:"card-homework-item"},[i("div",{staticClass:"card-item-list"},n._l(n.info,function(t){return i("div",{key:t.id,class:["list-cicle",1==n.formatStatus(t.type,t.id)?"cicle-active":""],on:{click:function(e){n.slideToNumber(t.seq)}}},[n._v(n._s(t.seq))])}))])])]):n._e()])],1)},staticRenderFns:[]};var N=n("VU/8")(S,q,!1,function(e){n("YG7V")},null,null);t.default=N.exports}});